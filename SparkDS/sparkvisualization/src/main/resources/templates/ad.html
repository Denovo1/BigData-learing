<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>实时统计</title>
    <link href="../static/favicon.ico" type="image/x-icon" rel="shortcut icon">
    <script type="application/javascript" th:src="@{../static/js/bootstrap.min.js}"></script>
    <script type="application/javascript" th:src="@{../static/js/bootstrap-select.min.js}"></script>
    <script type="application/javascript" th:src="@{../static/js/cronGen.min.js}"></script>
    <script type="application/javascript" th:src="@{../static/js/jquery_3.4.1_jquery.js}"></script>
    <script type="application/javascript" th:src="@{../static/js/echarts_4.6.0_echarts.js}"></script>
<!--    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/echarts/4.6.0/echarts.min.js"></script>-->
    <link rel="stylesheet" th:href="@{../static/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{../static/css/cronGen.css}">
    <style>
        .top {
            background-image: url("/static/img/bak2.jpg");
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
            width: 100%;
            height: 100px;
            line-height: 100px;
            text-align: center;
            /*border:1px solid #F00;*/
            font-weight: bold;
            font-size: 80px;
            color: #fffded;
        }

        body {
            background-image: url("/static/img/bak1.jpg");
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .container-fluid {
            background-image: url("/static/img/bak0.jpg");
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
            width: 600px;
            height: 1625px;
            float: left;
            /*margin-top: 30px;*/
        }

        .blacklist {
            background-image: url("/static/img/bg3.png");
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
            width: 2430px;
            height: 200px;
            float: left;
            top: 50%;
            line-height: 200px;
            text-align: center;
            font-size: 40px;
            color: #fffcdd;
        }

        .adshow {
            width: 2430px;
            height: 1420px;
            float: left;
        }
    </style>
</head>
<body>
<div class="top">广告点击实时统计</div>
<div class="container-fluid">
    <table class="table table-bordered">
        <thead>
        <tr class="active">
            <th>省份</th>
            <th>Top3广告</th>
        </tr>
        </thead>
        <tbody id="tabletest">
        <tr th:each="item,itemStat:${pro0}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro1}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro2}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro3}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro4}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro5}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro6}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro7}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro8}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro9}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro10}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro11}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro12}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro13}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro14}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro15}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro16}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro17}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro18}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro19}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro20}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro21}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro22}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro23}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro24}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro25}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro26}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro27}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro28}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro29}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro30}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro31}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro32}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        <tr th:each="item,itemStat:${pro33}">
            <td th:id="province_+${item.province}" th:text="${item.province}"></td>
            <td th:id="adid_+${item.province}" th:text="${item.adid}"></td>
        </tr>
        </tbody>
    </table>
</div>
<script th:inline="javascript">
    window.setInterval(function () {
        $.ajax({
            cache: false,
            type: 'GET',
            url: '/adshow/gettop',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                var testTbody = $("#tabletest");
                testTbody.empty();
                $.each(data, function (i, list) {
                    var test = "<tr>"
                        + "<td>" + list.province + "</td>"
                        + "<td>" + list.adid + "</td>"
                    "</tr>";
                    testTbody.append(test);
                });
            }
        });
    }, 1000);
</script>
<div id="blackuser" class="blacklist" th:text='${blackuser}'>
</div>
<script th:inline="javascript">
    window.setInterval(function () {
        $.ajax({
            cache: false,
            type: 'GET',
            url: '/adshow/getblacklist',
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                var str = data.value;
                $("#blackuser").html(str)
            }
        });
    }, 1000);
</script>
<div style="width: 2430px;height: 1424px;float: left">
    <div id="adshow" class="adshow"></div>
    <input type="hidden" id="theadid" th:value='${theadid}'>
    <!--<input type="hidden" id="adlist" th:value='${adlist}'>-->
</div>
<script th:inline="javascript">
    var myChart = echarts.init(document.getElementById('adshow'));
    var adid = $("#theadid").val();
    var minutes = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59'];
    var hours = ['12a', '1a', '2a', '3a', '4a', '5a', '6a',
        '7a', '8a', '9a', '10a', '11a',
        '12p', '1p', '2p', '3p', '4p', '5p',
        '6p', '7p', '8p', '9p', '10p', '11p'];

    window.setInterval(function () {
        $.ajax({
            cache: false,
            method: 'GET',
            url: '/adshow/show?adid=' + adid,
            dataType: 'json',
            contentType: 'application/json',
            success: function (datas) {

                // var jsonstr = JSON.parse(datas);
                var data = [];
                for (var i = 0; i < datas.length; i++) {
                    data.push([datas[i].hour, datas[i].minute, datas[i].clickCount]);
                }
                data = data.map(function (item) {
                    return [item[1], item[0], item[2]];
                });
                myChart.setOption({
                    tooltip: {
                        position: 'top'
                    },
                    animation: false,
                    grid: {
                        height: '95%',
                        width: '95%',
                        top: '2%',
                        left: '2%',
                        right: '0%'
                    },
                    xAxis: {
                        type: 'category',
                        data: minutes,
                        splitArea: {
                            show: true
                        },
                        axisLabel: {
                            textStyle: {
                                fontSize: 20,
                                color: '#fff8f3'
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#fff8f3',
                                width: 10
                            }
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: hours,
                        splitArea: {
                            show: true
                        },
                        axisLabel: {
                            textStyle: {
                                fontSize: 20,
                                color: '#fff8f3'
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: '#fff8f3',
                                width: 10
                            }
                        }
                    },
                    visualMap: {
                        show: false,
                        min: 1,
                        max: 200,
                        calculable: true,
                        orient: 'horizontal',
                        left: 'center',
                        bottom: '0%'
                    },
                    series: [{
                        name: '广告数',
                        type: 'heatmap',
                        data: data,
                        label: {
                            show: true
                        },
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowColor: 'rgba(0, 0, 0, 0.5)',
                                color: '#de000c'
                            }
                        }
                    }]
                });

            }
        });
    }, 1000);

</script>

</body>
</html>

